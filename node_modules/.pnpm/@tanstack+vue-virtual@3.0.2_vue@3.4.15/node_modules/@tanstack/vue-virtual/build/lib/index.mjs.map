{"version":3,"file":"index.mjs","sources":["../../src/index.ts"],"sourcesContent":["import {\n  elementScroll,\n  observeElementOffset,\n  observeElementRect,\n  observeWindowOffset,\n  observeWindowRect,\n  PartialKeys,\n  Virtualizer,\n  VirtualizerOptions,\n  windowScroll,\n} from '@tanstack/virtual-core'\nimport {\n  computed,\n  onScopeDispose,\n  Ref,\n  shallowRef,\n  triggerRef,\n  unref,\n  watch,\n} from 'vue'\nexport * from '@tanstack/virtual-core'\n\ntype MaybeRef<T> = T | Ref<T>\n\nfunction useVirtualizerBase<\n  TScrollElement extends Element | Window,\n  TItemElement extends Element,\n>(\n  options: MaybeRef<VirtualizerOptions<TScrollElement, TItemElement>>,\n): Ref<Virtualizer<TScrollElement, TItemElement>> {\n  const virtualizer = new Virtualizer(unref(options))\n  const state = shallowRef(virtualizer)\n\n  const cleanup = virtualizer._didMount()\n\n  watch(\n    () => unref(options).getScrollElement(),\n    (el) => {\n      if (el) {\n        virtualizer._willUpdate()\n      }\n    },\n    {\n      immediate: true,\n    },\n  )\n\n  watch(\n    () => unref(options),\n    (options) => {\n      virtualizer.setOptions({\n        ...options,\n        onChange: (instance, sync) => {\n          triggerRef(state)\n          options.onChange?.(instance, sync)\n        },\n      })\n\n      virtualizer._willUpdate()\n      triggerRef(state)\n    },\n    {\n      immediate: true,\n    },\n  )\n\n  onScopeDispose(cleanup)\n\n  return state\n}\n\nexport function useVirtualizer<\n  TScrollElement extends Element,\n  TItemElement extends Element,\n>(\n  options: MaybeRef<\n    PartialKeys<\n      VirtualizerOptions<TScrollElement, TItemElement>,\n      'observeElementRect' | 'observeElementOffset' | 'scrollToFn'\n    >\n  >,\n): Ref<Virtualizer<TScrollElement, TItemElement>> {\n  return useVirtualizerBase<TScrollElement, TItemElement>(\n    computed(() => ({\n      observeElementRect: observeElementRect,\n      observeElementOffset: observeElementOffset,\n      scrollToFn: elementScroll,\n      ...unref(options),\n    })),\n  )\n}\n\nexport function useWindowVirtualizer<TItemElement extends Element>(\n  options: MaybeRef<\n    PartialKeys<\n      VirtualizerOptions<Window, TItemElement>,\n      | 'observeElementRect'\n      | 'observeElementOffset'\n      | 'scrollToFn'\n      | 'getScrollElement'\n    >\n  >,\n): Ref<Virtualizer<Window, TItemElement>> {\n  return useVirtualizerBase<Window, TItemElement>(\n    computed(() => ({\n      getScrollElement: () => (typeof document !== 'undefined' ? window : null),\n      observeElementRect: observeWindowRect,\n      observeElementOffset: observeWindowOffset,\n      scrollToFn: windowScroll,\n      initialOffset:\n        typeof document !== 'undefined' ? window.scrollY : undefined,\n      ...unref(options),\n    })),\n  )\n}\n"],"names":["useVirtualizerBase","options","virtualizer","Virtualizer","unref","state","shallowRef","cleanup","_didMount","watch","getScrollElement","el","_willUpdate","immediate","setOptions","_extends","onChange","instance","sync","triggerRef","onScopeDispose","useVirtualizer","computed","observeElementRect","observeElementOffset","scrollToFn","elementScroll","useWindowVirtualizer","document","window","observeWindowRect","observeWindowOffset","windowScroll","initialOffset","scrollY","undefined"],"mappings":";;;;;;;;;;;;;;;AAwBA,SAASA,kBAAkBA,CAIzBC,OAAmE,EACnB;EAChD,IAAMC,WAAW,GAAG,IAAIC,WAAW,CAACC,KAAK,CAACH,OAAO,CAAC,CAAC,CAAA;AACnD,EAAA,IAAMI,KAAK,GAAGC,UAAU,CAACJ,WAAW,CAAC,CAAA;AAErC,EAAA,IAAMK,OAAO,GAAGL,WAAW,CAACM,SAAS,EAAE,CAAA;AAEvCC,EAAAA,KAAK,CACH,YAAA;AAAA,IAAA,OAAML,KAAK,CAACH,OAAO,CAAC,CAACS,gBAAgB,EAAE,CAAA;GACvC,EAAA,UAACC,EAAE,EAAK;AACN,IAAA,IAAIA,EAAE,EAAE;MACNT,WAAW,CAACU,WAAW,EAAE,CAAA;AAC3B,KAAA;AACF,GAAC,EACD;AACEC,IAAAA,SAAS,EAAE,IAAA;AACb,GACF,CAAC,CAAA;AAEDJ,EAAAA,KAAK,CACH,YAAA;IAAA,OAAML,KAAK,CAACH,OAAO,CAAC,CAAA;GACpB,EAAA,UAACA,OAAO,EAAK;AACXC,IAAAA,WAAW,CAACY,UAAU,CAAAC,QAAA,KACjBd,OAAO,EAAA;AACVe,MAAAA,QAAQ,EAAE,SAAAA,QAAAA,CAACC,QAAQ,EAAEC,IAAI,EAAK;QAC5BC,UAAU,CAACd,KAAK,CAAC,CAAA;QACjBJ,OAAO,CAACe,QAAQ,IAAA,IAAA,IAAhBf,OAAO,CAACe,QAAQ,CAAGC,QAAQ,EAAEC,IAAI,CAAC,CAAA;AACpC,OAAA;AAAC,KAAA,CACF,CAAC,CAAA;IAEFhB,WAAW,CAACU,WAAW,EAAE,CAAA;IACzBO,UAAU,CAACd,KAAK,CAAC,CAAA;AACnB,GAAC,EACD;AACEQ,IAAAA,SAAS,EAAE,IAAA;AACb,GACF,CAAC,CAAA;EAEDO,cAAc,CAACb,OAAO,CAAC,CAAA;AAEvB,EAAA,OAAOF,KAAK,CAAA;AACd,CAAA;AAEO,SAASgB,cAAcA,CAI5BpB,OAKC,EAC+C;EAChD,OAAOD,kBAAkB,CACvBsB,QAAQ,CAAC,YAAA;AAAA,IAAA,OAAAP,QAAA,CAAA;AACPQ,MAAAA,kBAAkB,EAAEA,kBAAkB;AACtCC,MAAAA,oBAAoB,EAAEA,oBAAoB;AAC1CC,MAAAA,UAAU,EAAEC,aAAAA;KACTtB,EAAAA,KAAK,CAACH,OAAO,CAAC,CAAA,CAAA;AAAA,GACjB,CACJ,CAAC,CAAA;AACH,CAAA;AAEO,SAAS0B,oBAAoBA,CAClC1B,OAQC,EACuC;EACxC,OAAOD,kBAAkB,CACvBsB,QAAQ,CAAC,YAAA;AAAA,IAAA,OAAAP,QAAA,CAAA;MACPL,gBAAgB,EAAE,SAAAA,gBAAA,GAAA;AAAA,QAAA,OAAO,OAAOkB,QAAQ,KAAK,WAAW,GAAGC,MAAM,GAAG,IAAI,CAAA;OAAC;AACzEN,MAAAA,kBAAkB,EAAEO,iBAAiB;AACrCN,MAAAA,oBAAoB,EAAEO,mBAAmB;AACzCN,MAAAA,UAAU,EAAEO,YAAY;MACxBC,aAAa,EACX,OAAOL,QAAQ,KAAK,WAAW,GAAGC,MAAM,CAACK,OAAO,GAAGC,SAAAA;KAClD/B,EAAAA,KAAK,CAACH,OAAO,CAAC,CAAA,CAAA;AAAA,GACjB,CACJ,CAAC,CAAA;AACH;;;;"}